---
title: "RWC and LDMC"
author: "Indra Boving & Joe Celebrezze"
date: "4/20/2021"
output: html_document
---

This script contains data and analysis for calculating RWC and LDMC from rehydrated leaves, and determining if LDMC and/or RWC predict 1) TLP, 2) Flammability in the manner similar to or different from water potential or LFM. 

# Setup
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# install the package first if you haven't already, then load it
library(tidyverse)
library(here)
library(ggplot2)
library(MetBrewer)
library(lme4)
library(sjPlot)
library(AICcmodavg)
library(remef)
library(ggpubr)
library(janitor)
library(lubridate)                             # Install & load scales
library("scales")
```

Set global options for color palettes and themes: 

```{r}
th <- theme(panel.background = element_rect(fill='white', colour='black'), # Make background white and border black
          panel.grid.major = element_blank(),  # Hide major gridlines
          panel.grid.minor = element_blank())

th.spp.wrap <- theme(legend.position = "bottom", 
        strip.text = element_text(face = "italic", size = 12) +
  scale_color_manual(values=met.brewer("Morgenstern", 7)))

Morgenstern = list(c("#7c668c", "#b08ba5", "#dfbbc8", "#ffc680", "#ffb178", "#db8872", "#a56457"), c(7, 5, 4, 6, 3, 2, 1), colorblind=TRUE)
```


Plotting options
```{r}
color_panels <- scale_color_manual(values=c("#9D0208",'#669bbc')) 

th_panels <- theme(
        axis.title.x=element_blank(),
        axis.title.y=element_text(face = 'bold', size = 18),
        legend.position = "none", 
        aspect.ratio = 1, 
        plot.margin = unit(c(0,0,0,0), "cm")
        )
```
#------------------------------------
# 1. Data wrangling

Reading in data and calculating Saturated Water Content (SWC), Relative Water Content (RWC), and Leaf Dry Matter Content (LDMC)

To start, try calculated SWC based on the samples with the highest LFM or the most hydrated mpa.scaled(whichever is higher):

```{r}
rwc_raw <- read.csv(here('processed-data', 'mem.data.subset.alldates.csv')) #%>% 
  # select(individual, spp, mpa, lfm.unscaled, dw.flam.sample.unscaled, ww.flam.sample.unscaled, flam.sample.wt.unscaled, PC1, tti, fd, gd) 

#Find the maximum hydrated samples based on LFM and calculate LDMC, SWC:

rwc_max_lfm_df <- rwc_raw %>% 
  group_by(individual) %>% 
  slice_max(lfm.unscaled, with_ties = T) %>% 
  ungroup() %>% 
  mutate(ldmc = (dw.flam.sample.unscaled/flam.sample.wt.unscaled), 
         swc = (ww.flam.sample.unscaled/dw.flam.sample.unscaled), 
         value = lfm.unscaled) %>% 
  #filter(mpa.scaled> -.5) %>% 
    select(individual, ldmc, swc, value) 

#Same but with MPa: 
rwc_max_mpa_df <- rwc_raw %>% 
  group_by(individual) %>% 
  slice_max(mpa, with_ties = T) %>% 
  ungroup() %>% 
  mutate(ldmc = (dw.flam.sample.unscaled/flam.sample.wt.unscaled), 
         swc = (ww.flam.sample.unscaled/dw.flam.sample.unscaled), 
         value = mpa) %>% 
  #filter(mpa.scaled> -.5) %>% 
    select(individual, ldmc, swc, value) 

#Check out those datasets: 
swc_max_highest <- bind_rows(rwc_max_lfm_df, rwc_max_mpa_df) %>% 
  group_by(individual) %>% 
  slice_max(swc, with_ties = F) %>% 
  select(individual, swc)

ldmc_min_lowest <- bind_rows(rwc_max_lfm_df, rwc_max_mpa_df) %>% #lower LDMC = less water
  group_by(individual) %>% 
  slice_min(ldmc, with_ties = F) %>% 
  select(individual, ldmc)

#Combine into one df with individual, the most hydrated SWC and the most hydrated LDMC: 
rwc_max_highest <- merge(swc_max_highest, ldmc_min_lowest, by = c("individual"))

rwc_df <- merge(rwc_raw, rwc_max_highest, by = c("individual"), all = T) %>% 
  mutate(water.content = (ww.flam.sample.unscaled/dw.flam.sample.unscaled), 
         rwc.unscaled = (water.content/swc),
         ldmc.unscaled = ldmc) 
```

The highest SWC is always the most hydrated LFM, which makes more sense to use as using mpa.scalednearly always gives us RWC > 100%. 

This works, but is not exactly how a PV curve would calculate SWC. Try with the intercept of the relationship between water.content and mpa:

```{r}
rwc_df %>% 
  ggplot(aes(y = water.content, x = mpa.unscaled, color = individual)) +
  geom_point() +
  theme(legend.position = "none") +
  geom_smooth(method = "lm", se = F)

rwc_int_subset <- rwc_df %>% 
  filter(mpa.unscaled > -2)

swc_mod <- lmer(water.content ~ mpa.unscaled + (1|individual), data = rwc_int_subset)

ind_ints <- as.data.frame(coef(swc_mod)$individual) %>% 
  rownames_to_column(var = "individual") %>% 
  rename(slope = mpa.unscaled, 
         intercept = '(Intercept)') %>% 
  select(individual, 
          intercept, slope)

ind_ints

#combine with previous attempt to get a swc:

rwc_swc_df <- merge(rwc_df, ind_ints, by = c("individual")) %>% 
 # select(individual, mpa, swc, intercept, water.content, rwc.unscaled, ldmc) %>% 
  mutate(rwc.int.unscaled = (water.content/intercept))

rwc_swc_df %>% 
  ggplot(aes(y = rwc.unscaled, x = rwc.int.unscaled))+
  geom_point()
```


When we extrapolate, we get a lot of RWCs that are greater than 100...which is a bit strange, conceptually. Force those to be 100. 

```{r}
rwc_swc_df2 <- rwc_swc_df %>% 
  mutate(rwc.int.unscaled = case_when(
    #rwc.int.unscaled > 1.001 ~ NA_real_, 
    rwc.int.unscaled > 1.001 ~ 1, 
    TRUE ~ rwc.int.unscaled
  )) 

rwc_swc_df2 %>% 
  ggplot(aes(y = rwc.unscaled, x = rwc.int.unscaled))+
  geom_point()
```
This is better! Let's go with this version for SWC, as it's the most similar to PV curves. For LDMC, we'll stick with the previous way (dry matter content of the most hydrated leaf in terms of LFM), as LDMF does not have as many other measurements hinging on it. (Could be convinced otherwise here though - could subset rows where RWC = 100 and write ldmc = (dw.flam.sample/(dw.flam.sample + sat.water.content)))

Combine rwc_df with TLP:

```{r}
rwc_pv_raw <- read.csv(here("processed-data", "pv_summary_df_timing.csv")) %>% 
  filter(timing == "fall") %>% 
  select(-timing)

rwc_pv_df <- merge(rwc_pv_raw, rwc_swc_df2, by = c("spp")) %>% 
  mutate(swc.int = intercept) %>% 
  group_by(spp) %>% 
  mutate(rwc.noint = scale(rwc.unscaled), 
         rwc = scale(rwc.int.unscaled),
         ldmc = scale(ldmc)) %>% 
  mutate(season = case_when(
    precip.2mo < 0.5 ~ "Dry", 
    precip.2mo > 0.5 ~ "Wet")
  ) %>% 
  mutate(site.test = case_when( 
    site == "St. Marys" ~ 1,
    site == "Painted Caves" ~ 2
  )) %>%
  mutate(season = case_when(
    timing %in% c("Dec. 2019", "Dec. 2016", "Jan. 2018", "Jan. 2020") ~ "Wet", 
    timing == "Sept. 2020" ~ "Dry"
  ))
```

# ---------------------------------------

#Comment 1: RWC?

"One suggestion I have for the authors is for them to also included discussion (and likely data) of relative water content. Relative water content and live fuel moisture should be related
(considering that both rely on fresh and dry weight, though RWC also requires saturated water
content) and the authors should have all of the raw data to be able to also determine RWC. 
This would be a further link between fire scientists and eco-physiologists. I see they report the
pressure-volume curve TLP, but I believe they could also determine a RWC for each LFM data
point they have. If so, this might best fit in the Discussion section “4.2 | Both plant hydration
and dry matter content affect flammability.”

      - Reviewer 3
      

# MAIN MODEL SELECTION - RWC

#2.0 PC1

From previous analysis: 

"From our first round of model selection, it appears that site, species, and year.month are all important variables to include, and sample.wt should probably be included as well despite worsening the models slightly.

Below, I am going to perform another round of model selection with all possible permutations of the following metrics: mpa, lfm, dw.flam.sample, ww.flam.sample, excess_water.scaledwith the caveat that some combinations of metrics absolutely do NOT work. Those combinations are as follows:
  - dw.flam.sample, ww.flam.sample and sample.wt
  - dw.flam.sample, lfm, ww.flam.sample
  - lfm, dw.flam.sample
  - lfm, ww.flam.sample
  - lfm, excess_water.scaled
  - ww.flam.sample, excess_water.scaled
  - dw.flam.sample, excess_water.scaled (with sample.wt)
  - dw.flam.sample, ww.flam.sample (with sample.wt)
  
These do not work, as live fuel moisture was used in the calculations of these metrics, therefore they return very high VIF values that signal to us that they cannot be used in the mixed effects models together."

Additionally, in this second analysis, the following combinations will not work: 

  - rwc and ww.flam.sample
  - rwc and dw.flam.sample
  - rwc and excess.water.scaled
  
Run models: 

```{r}
m1 <- lmer(PC1 ~ lfm + spp + site + year.month + sample.wt + (1 | individual), data = rwc_pv_df)

m1.5 <- lmer(PC1 ~ lfm + spp + site + year.month + sample.wt + rwc + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m1.5)

m2 <- lmer(PC1 ~ mpa.scaled+ spp + site + year.month + sample.wt + (1 | individual), data = rwc_pv_df)

m2.5 <- lmer(PC1 ~ mpa.scaled+ spp + site + year.month + sample.wt + rwc + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m2.5)

m3 <- lmer(PC1 ~ dw.flam.sample + spp + site + year.month + sample.wt + (1 | individual), data = rwc_pv_df)

m4 <- lmer(PC1 ~ ww.flam.sample + spp + site + year.month + sample.wt + (1 | individual), data = rwc_pv_df)


m5 <- lmer(PC1 ~ excess_water.scaled + spp + site + year.month + sample.wt + (1 | individual), data = rwc_pv_df)

m6 <- lmer(PC1 ~ lfm + mpa.scaled+ spp + site + year.month + sample.wt + (1 | individual), data = rwc_pv_df)

#performance::multicollinearity(m6)

m6.5 <- lmer(PC1 ~ lfm + mpa.scaled+ spp + site + year.month + sample.wt + rwc +(1 | individual), data = rwc_pv_df)

m7 <- lmer(PC1 ~ mpa.scaled+ dw.flam.sample + spp + site + year.month + sample.wt + (1 | individual), data = rwc_pv_df)

m8 <- lmer(PC1 ~ mpa.scaled+ ww.flam.sample + spp + site + year.month + sample.wt + (1 | individual), data = rwc_pv_df)


m9 <- lmer(PC1 ~ mpa.scaled+ excess_water.scaled + spp + site + year.month + sample.wt + (1 | individual), data = rwc_pv_df)

m10 <- lmer(PC1 ~ mpa.scaled+ dw.flam.sample + ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m11 <- lmer(PC1 ~ dw.flam.sample + excess_water.scaled + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m12 <- lmer(PC1 ~ dw.flam.sample + ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

##

m13.5 <- lmer(PC1 ~ spp + site + year.month + rwc + (1 | individual), data = rwc_pv_df)

m14.5 <- lmer(PC1 ~ spp + mpa.scaled+ site + year.month + rwc + (1 | individual), data = rwc_pv_df)

m15.5 <- lmer(PC1 ~ spp + lfm + site + year.month + rwc + (1 | individual), data = rwc_pv_df)
```

```{r}
model_list <- c(m1, m2, m3, m4, m5, m6, m7, m8, m9, m10, m11, m12, m13.5, m14.5, m15.5, m1.5, m2.5)

aictab(model_list)
```

With RWC included in the model, one of the new top models is m14.5, which includes RWC

m14.5 <- PC1 ~ spp + mpa.scaled+ site + year.month + rwc + (1 | individual)

m2 <- PC1 ~ mpa.scaled+ spp + site + year.month + sample.wt + (1 | individual)

```{r}
summary(m14.5, ddf = 'Kenward-Roger')

summary(m2, ddf = 'Kenward-Roger')
```


CONCLUSION: The best model that includes RWC as a covariate is m14.5, which includes both mpa.scaledand RWC. This is not a significantly better or worse model than the previously identified top model (m2). 

# 2.1. Predicting raw metrics (part 2)

## Time to Ignition
Models
```{r}
m1 <- lmer(tti ~ mpa.scaled + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m2 <- lmer(tti ~ lfm + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m3 <- lmer(tti ~ ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m4 <- lmer(tti ~ dw.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m5 <- lmer(tti ~ mpa.scaled + dw.flam.sample + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)

# Adding in mpa.scaled+ WW and mpa.scaled+ LFM despite their moderate collinearity to see how they affect model selection
m6 <- lmer(tti ~ mpa.scaled + ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m7 <- lmer(tti ~ mpa.scaled + lfm + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)

#rwc models: 
m2.5 <- lmer(tti ~ mpa.scaled + spp + site + year.month + sample.wt + rwc + (1 | individual), data = rwc_pv_df)

m3.5 <- lmer(tti ~ spp + site + year.month + sample.wt + rwc + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m2.5)
m4.5 <- lmer(tti ~ spp + site + year.month + rwc + (1 | individual), data = rwc_pv_df)

m5.5 <- lmer(tti ~ spp + mpa.scaled + site + year.month + rwc + (1 | individual), data = rwc_pv_df)
```

```{r}
model_list <- c(m1, m2, m3, m4, m5, m6, m7, m2.5, m3.5, m4.5, m5.5)

aictab(model_list)
```

conclusion: For TTI, RWC models are in the top, and the inclusion of RWC does improve the model. However, RWC is a non-significant addition to the model, while mpa.scaledis still the more signficant predictor. 

New top model by AIC:

m2.5 <- lmer(tti ~ mpa.scaled + spp + site + year.month + sample.wt + rwc + (1 | individual), data = rwc_pv_df)


## Flame Height
Models
```{r}
m1 <- lmer(fh ~ mpa.scaled + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m2 <- lmer(fh ~ lfm + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m3 <- lmer(fh ~ ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m4 <- lmer(fh ~ dw.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m5 <- lmer(fh ~ mpa.scaled + dw.flam.sample + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)

# Adding in mpa.scaled+ WW and mpa.scaled+ LFM despite their moderate collinearity to see how they affect model selection
m6 <- lmer(fh ~ mpa.scaled + ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m7 <- lmer(fh ~ mpa.scaled + lfm + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m2.5 <- lmer(fh ~ mpa.scaled + spp + site + year.month + sample.wt + rwc + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m2.5)

m3.5 <- lmer(fh ~ spp + site + year.month + sample.wt + rwc + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m3.5)
m4.5 <- lmer(fh ~ spp + site + year.month + rwc + (1 | individual), data = rwc_pv_df)

m5.5 <- lmer(fh ~ spp + mpa.scaled + site + year.month + rwc + (1 | individual), data = rwc_pv_df)

```


```{r}
model_list <- c(m1, m2, m3, m4, m5, m6, m7, m2.5, m3.5, m4.5, m5.5)

aictab(model_list)
```
Conclusion: For FH, model with RWC along and RWC + mpa.scaledboth performed equally well by AIC, with model with mpa.scaledand RWC performing equally. 

```{r}
m2.5
m5.5
m5

anova(m2.5, m5.5)
```


## Glow Duration
Models
```{r}
m1 <- lmer(gd ~ mpa.scaled + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m2 <- lmer(gd ~ lfm + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m3 <- lmer(gd ~ ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m4 <- lmer(gd ~ dw.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m5 <- lmer(gd ~ mpa.scaled + dw.flam.sample + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)

# Adding in mpa.scaled+ WW and mpa.scaled+ LFM despite their moderate collinearity to see how they affect model selection
m6 <- lmer(gd ~ mpa.scaled + ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m7 <- lmer(gd ~ mpa.scaled + lfm + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m2.5 <- lmer(gd ~ mpa.scaled + spp + site + year.month + sample.wt + rwc + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m2.5)


m3.5 <- lmer(gd ~ spp + site + year.month + sample.wt + rwc + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m3.5)
m4.5 <- lmer(gd ~ spp + site + year.month + rwc + (1 | individual), data = rwc_pv_df)

m5.5 <- lmer(gd ~ spp + mpa.scaled + site + year.month + rwc + (1 | individual), data = rwc_pv_df)

```


```{r}
model_list <- c(m1, m2, m3, m4, m5, m6, m7, m2.5, m3.5, m4.5, m5.5)

aictab(model_list)
```
Conclusion: Like TTI and FH, one of top model includes mpa.scaledand RWC. (RWC does a better job catching the dry weight and wet weigh dynamics than LFM? Even though it does technically have dry weight?)

```{r}
m2.5
m5
m7

anova(m2.5, m5, m7)
```



## Flame Duration


Models
```{r}
m1 <- lmer(fd ~ mpa.scaled + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m2 <- lmer(fd ~ lfm + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m3 <- lmer(fd ~ ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m4 <- lmer(fd ~ dw.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m5 <- lmer(fd ~ mpa.scaled + dw.flam.sample + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)

# Adding in mpa.scaled+ WW and mpa.scaled+ LFM despite their moderate collinearity to see how they affect model selection
m6 <- lmer(fd ~ mpa.scaled + ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m7 <- lmer(fd ~ mpa.scaled + lfm + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m2.5 <- lmer(fd ~ mpa.scaled + spp + site + year.month + sample.wt + rwc + (1 | individual), data = rwc_pv_df)

m3.5 <- lmer(fd ~ spp + site + year.month + sample.wt + rwc + (1 | individual), data = rwc_pv_df)

#performance::multicollinearity(m3.5)
m4.5 <- lmer(fd ~ spp + site + year.month + rwc + (1 | individual), data = rwc_pv_df)

m5.5 <- lmer(fd ~ spp + mpa.scaled + site + year.month + rwc + (1 | individual), data = rwc_pv_df)

```


```{r}
model_list <- c(m1, m2, m3, m4, m5, m6, m7, m2.5, m3.5, m4.5, m5.5)

aictab(model_list)
```
Conclusion: For flame duration, the following models were within the top models, all of which included mpa.scaled(either with RWC or mpa.scaledalone). One also included dry weight.


```{r}
m5.5
m1
m2.5
m4
```

## Max. Temp.

Models
```{r}
m1 <- lmer(temp.max ~ mpa.scaled + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m2 <- lmer(temp.max ~ lfm + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m3 <- lmer(temp.max ~ ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m4 <- lmer(temp.max ~ dw.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m5 <- lmer(temp.max ~ mpa.scaled + dw.flam.sample + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)

# Adding in mpa.scaled+ WW and mpa.scaled+ LFM despite their moderate collinearity to see how they affect model selection
m6 <- lmer(temp.max ~ mpa.scaled + ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m7 <- lmer(temp.max ~ mpa.scaled + lfm + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m2.5 <- lmer(temp.max ~ mpa.scaled + spp + site + year.month + sample.wt + rwc + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m2.5)



m3.5 <- lmer(temp.max ~ spp + site + year.month + sample.wt + rwc + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m3.5)

m4.5 <- lmer(temp.max ~ spp + site + year.month + rwc + (1 | individual), data = rwc_pv_df)

m5.5 <- lmer(temp.max ~ spp + mpa.scaled + site + year.month + rwc + (1 | individual), data = rwc_pv_df)

```


```{r}
model_list <- c(m1, m2, m3, m4, m5, m6, m7, m2.5, m3.5, m4.5, m5.5)

aictab(model_list)
```
Conclusion: Top model for max temp includes RWC, MPa, and sample weight. 

```{r}
m2.5
m5
```

## Post-Flame Glow
Models
```{r}
m1 <- lmer(pfg ~ mpa.scaled + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m2 <- lmer(pfg ~ lfm + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m3 <- lmer(pfg ~ ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m4 <- lmer(pfg ~ dw.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m5 <- lmer(pfg ~ mpa.scaled + dw.flam.sample + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)

# Adding in mpa.scaled+ WW and mpa.scaled+ LFM despite their moderate collinearity to see how they affect model selection
m6 <- lmer(pfg ~ mpa.scaled + ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m7 <- lmer(pfg ~ mpa.scaled + lfm + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m2.5 <- lmer(pfg ~ mpa.scaled + spp + site + year.month + sample.wt + rwc + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m2.5)



m3.5 <- lmer(pfg ~ spp + site + year.month + sample.wt + rwc + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m3.5)

m4.5 <- lmer(pfg ~ spp + site + year.month + rwc + (1 | individual), data = rwc_pv_df)

m5.5 <- lmer(pfg ~ spp + mpa.scaled + site + year.month + rwc + (1 | individual), data = rwc_pv_df)

```


```{r}
model_list <- c(m1, m2, m3, m4, m5, m6, m7, m2.5, m3.5, m4.5, m5.5)

aictab(model_list)
```
conclusion: top model again for PfG includes RWC and mpa.scaledor mpa.scaledand sample weights or mpa.scaledand LFM

```{r}
m2.5
m5
m7
```


## Time to First Glow
Models
```{r}
m1 <- lmer(ttfg ~ mpa.scaled + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m2 <- lmer(ttfg ~ lfm + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m3 <- lmer(ttfg ~ ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m4 <- lmer(ttfg ~ dw.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m5 <- lmer(ttfg ~ mpa.scaled + dw.flam.sample + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)

# Adding in mpa.scaled+ WW and mpa.scaled+ LFM despite their moderate collinearity to see how they affect model selection

m6 <- lmer(ttfg ~ mpa.scaled + ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m7 <- lmer(ttfg ~ mpa.scaled + lfm + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)
m2.5 <- lmer(ttfg ~ mpa.scaled + spp + site + year.month + sample.wt + rwc + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m2.5)

m3.5 <- lmer(ttfg ~ spp + site + year.month + sample.wt + rwc + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m3.5)

m4.5 <- lmer(ttfg ~ spp + site + year.month + rwc + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m4.5)

m5.5 <- lmer(ttfg ~ spp + mpa.scaled + site + year.month + rwc + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m5.5)
```


```{r}
model_list <- c(m1, m2, m3, m4, m5, m6, m7, m2.5, m3.5, m4.5, m5.5)

aictab(model_list)
```
conclusion: for TTFG, RWC was a covariate in 1/5 top performing models - does not do meaningfully better than other top metrics of physiology or dry weights. 

```{r}
m2.5
m6
m5
m11
m1
```
#CONCLUSIONS: 

Methods: 

To determine relative water content, we performed an extrapolated linear regression on points more hydrated than the TLP (~-3.0 MPa) as is done in PC curve analysis. Unlike PV Curves, our dry down utilized different leaves of varying dry masses, leading to occasional estimates of RWC that were greater than 100% (e.g., when samples measured at water potentials closest to zero had lower overall dry matter than samples measured at less hydrated water potentials); in these cases RWC was assumed to be 100% and was notated accordingly. Results were similar when we used the highest observed LFM or mpa.scaledas the saturated water content.


Results: 

Relative water content was a covariate in the top performing models for linear estimates of flammability. In the top models of all flammability metrics (including composite metric PC1), RWC was included when combined in models with water potential and generally performed as well as or slightly better than models that included water potential and another metric of sample weight or wet and/or dry matter (SI).

Discussion: 

Relative water content is a more physiologically-focused metric of water loss than LFM. RWC takes into account the amount of water relative to the maximum amount of water a plant may hold, which will be informed by the overall tissue in a plant. 


#3.0 RWC dynamics: 

#####3.1 Remef

Try scaling MPa from 0-1 and not changing RWC (since it's already on that 0-1 scale). 
```{r}
rwc_pv_df <- rwc_pv_df %>% 
  group_by(spp) %>% 
  mutate(mpa.0.1.scaled = rescale(mpa))
  
mparwc_mod <- lmer(rwc.int.unscaled ~ mpa.0.1.scaled + spp + season + site + (1 | individual), data = rwc_pv_df)

summary(mparwc_mod)

r1_rwc <- remef(mparwc_mod, fix = c('sppCEME', 'siteSt. Marys'),  ran = "all", keep.intercept = FALSE)

scaled_r1_rwc_df <- as.data.frame(r1_rwc)
###

rwc_rel_df <- cbind(scaled_r1_rwc_df, rwc_pv_df)

rwc_rel_df.adfa <- rwc_rel_df %>% 
  filter(spp == 'ADFA')
rwc_rel_df.ceme <- rwc_rel_df %>% 
  filter(spp == 'CEME')
```

```{r}
rwc_pv_df %>% 
  ggplot(aes(y = rwc.int.unscaled, x = year.month, fill = spp))+
  geom_boxplot()

rwc_pv_df %>% 
  ggplot(aes(y = rwc, x = year.month, fill = spp))+
  geom_boxplot()
```


####3.1 Figures

with remef: 

```{r}
mean_tlp_all <- rwc_pv_df %>% 
  mutate(mean_tlp_all = mean(mean_tlp)) %>% 
  select(mean_tlp_all)
  
lfm_rwc_plot<- rwc_rel_df  %>% 
 # mutate(mean_tlp_all = mean(mean_tlp)) %>% 
  ggplot(aes(
    y = 100 * r1_rwc,
    x = lfm.unscaled,
    color = season,
    shape = season
  )) +
  geom_point(alpha = .5,size = 2, )+
  geom_smooth(method = 'lm', se = F)+
 # ylim(0, 100) +
 # geom_abline() +
 # geom_vline(xintercept = mean_tlp_all)+
  facet_wrap(~Species) +
  theme(legend.position = "none",
        #axis.text.x = element_blank(),
        axis.text = element_text(size = 14)) +
  labs(x="Live Fuel Moisture (%)", y="Relative Water Content (%)") +
  annotate('text', x = 0, y = 97, label = 'a', size = 12) +
  th +
  scale_color_manual(values= c("#9D0208",'#669bbc'))
lfm_rwc_plot

mpa_rwc_plot <- rwc_rel_df  %>% 
  ggplot(aes(
    y = 100 * r1_rwc,
    x = mpa.unscaled,
    color = season,
    shape = season,
  )) +
  geom_point(alpha = .5,size = 2)+
  geom_smooth(method = 'lm', se = F) +
 # ylim(0, 100) +
  facet_wrap(~Species) +
  theme(legend.position = "none",
        #axis.text.x = element_blank(),
        axis.text = element_text(size = 14)) +
  labs(x="Water Potential (-Mpa)", y="") +
  annotate('text', x = -10, y = 97, label = 'b', size = 12) +
  th +
  scale_color_manual(values= c("#9D0208",'#669bbc'))

# rwc_rwc_plot <-rwc_pv_df %>% 
#   ggplot(aes(
#     x = 100 * rwc.unscaled,
#     y = 100 * rwc.int.unscaled,
#     color = spp,
#    # shape = year.month
#   )) +
#   geom_point(alpha = .5)+
#   geom_smooth(method = 'lm', se = F) +
#   ylim(0, 100) +
#   geom_abline() +
#   #coord_equal() +
#   theme(legend.position = "none",
#         #axis.text.x = element_blank(),
#         axis.text.y = element_text(size = 14)) +
#   labs(y="Relative Water Content (%)", x="RWClfm (%)") +
#   annotate('text', x = 0, y = 97, label = 'a', size = 12) +
#   th +
#   scale_color_manual(values= c("#9D0208","#F48C06"))


# lfm_mpa_plot <-rwc_pv_df %>% 
#   ggplot(aes(
#     x = lfm.unscaled,
#     y = mpa.unscaled,
#     color = Species,
#     shape = Species
#   )) +
#   geom_point(alpha = .5)+
#   geom_smooth(method = 'lm', se = F) +
#  # ylim(0, 100) +
#   #geom_abline() +
#   #coord_equal() +
#   theme(legend.position = "none",
#         #axis.text.x = element_blank(),
#         axis.text.y = element_text(size = 14)) +
#   labs(y="MPa", x="Live Fuel Moisture (%)") +
#   #scale_y_reverse()+
#   ylim(-10, 0)+
#   annotate('text', x = -.03, y = -0, label = 'c', size = 12) +
#   th +
#   scale_color_manual(values= c("#9D0208","#F48C06"))

rwc_plot1 <- cowplot::plot_grid(lfm_rwc_plot, mpa_rwc_plot, nrow = 1)

rwc_plot1

legend <- get_legend(
  # create some space to the left of the legend
  ggplot() + 
    geom_point(data= rwc_rel_df, aes(mpa.unscaled, PC1, color = season, shape = season), size = 5, alpha = .8) +
    color_panels +
    theme(legend.box.margin = margin(0, 0, 0, 0),
          legend.position = "top",
          legend.text = element_text(face = "italic", size = 18),
          legend.title = element_text(face = 'bold', size = 22),
          legend.key = element_rect(fill = "white"))
) # NOTE: CAUSING ERROR!! SCALED.MEM.DATA.SEPT2020 NOT FOUND; COLOR_PANELS NOT FOUND

rwc_plot2 <- cowplot::plot_grid (legend, rwc_plot1, ncol = 1, rel_heights = c(1,12), rel_widths = c(1,.5))
rwc_plot2

ggsave(here("figures", 'reviewer-figures', "Fig1_RWC_LFM_MPa.jpg"),
       plot = rwc_plot2, 
       width = 6, height = 3, dpi = 300)
```
Without remef: 

```{r}
mean_tlp_all <- rwc_pv_df %>% 
  mutate(mean_tlp_all = mean(mean_tlp)) %>% 
  select(mean_tlp_all)
  
lfm_rwc_plot<- rwc_pv_df  %>% 
 # mutate(mean_tlp_all = mean(mean_tlp)) %>% 
  ggplot(aes(
    y = 100 * rwc.int.unscaled,
    x = lfm.unscaled,
    color = season,
    shape = season
  )) +
  geom_point(alpha = .5,size = 2, )+
  geom_smooth(method = 'lm', se = F)+
  ylim(0, 100) +
  facet_wrap(~Species)+
 # geom_abline() +
 # geom_vline(xintercept = mean_tlp_all)+
  #facet_wrap(~year.month) +
  theme(legend.position = "none",
        #axis.text.x = element_blank(),
        axis.text = element_text(size = 14)) +
  labs(x="Live Fuel Moisture (%)", y="Relative Water Content (%)") +
  annotate('text', x = 0, y = 97, label = 'a', size = 12) +
  th +
  scale_color_manual(values= c("#9D0208",'#669bbc'))
lfm_rwc_plot
```


```{r}
mpa_rwc_plot <- rwc_pv_df %>% 
  ggplot(aes(
    y = 100 * rwc.int.unscaled,
    x = mpa.unscaled,
    color = season,
    shape = season
  )) +
  geom_point(alpha = .5,size = 2)+
  geom_smooth(method = 'lm', se = F) +
  ylim(0, 100) +
  facet_wrap(~Species) +
  theme(legend.position = "none",
        #axis.text.x = element_blank(),
        axis.text = element_text(size = 14)) +
  labs(x="Water Potential (-Mpa)", y="") +
  annotate('text', x = -10, y = 97, label = 'b', size = 12) +
  th +
  scale_color_manual(values= c("#9D0208",'#669bbc'))

# rwc_rwc_plot <-rwc_pv_df %>% 
#   ggplot(aes(
#     x = 100 * rwc.unscaled,
#     y = 100 * rwc.int.unscaled,
#     color = spp,
#    # shape = year.month
#   )) +
#   geom_point(alpha = .5)+
#   geom_smooth(method = 'lm', se = F) +
#   ylim(0, 100) +
#   geom_abline() +
#   #coord_equal() +
#   theme(legend.position = "none",
#         #axis.text.x = element_blank(),
#         axis.text.y = element_text(size = 14)) +
#   labs(y="Relative Water Content (%)", x="RWClfm (%)") +
#   annotate('text', x = 0, y = 97, label = 'a', size = 12) +
#   th +
#   scale_color_manual(values= c("#9D0208","#F48C06"))


# lfm_mpa_plot <-rwc_pv_df %>% 
#   ggplot(aes(
#     x = lfm.unscaled,
#     y = mpa.unscaled,
#     color = Species,
#     shape = Species
#   )) +
#   geom_point(alpha = .5)+
#   geom_smooth(method = 'lm', se = F) +
#  # ylim(0, 100) +
#   #geom_abline() +
#   #coord_equal() +
#   theme(legend.position = "none",
#         #axis.text.x = element_blank(),
#         axis.text.y = element_text(size = 14)) +
#   labs(y="MPa", x="Live Fuel Moisture (%)") +
#   #scale_y_reverse()+
#   ylim(-10, 0)+
#   annotate('text', x = -.03, y = -0, label = 'c', size = 12) +
#   th +
#   scale_color_manual(values= c("#9D0208","#F48C06"))

rwc_plot1 <- cowplot::plot_grid(lfm_rwc_plot, mpa_rwc_plot, nrow = 1)

rwc_plot1

legend <- get_legend(
  # create some space to the left of the legend
  ggplot() + 
    geom_point(data=rwc_pv_df, aes(mpa.unscaled, PC1, color = season, shape = season), size = 5, alpha = .8) +
    color_panels +
    theme(legend.box.margin = margin(0, 0, 0, 0),
          legend.position = "top",
          legend.text = element_text(face = "italic", size = 18),
          legend.title = element_text(face = 'bold', size = 22),
          legend.key = element_rect(fill = "white"))
)

rwc_plot2 <- cowplot::plot_grid (legend, rwc_plot1, ncol = 1, rel_heights = c(1,12), rel_widths = c(1,.5))
rwc_plot2

ggsave(here("figures", 'reviewer-figures', "Fig1_NOREMEF_RWC_LFM_MPa.jpg"),
       plot = rwc_plot2, 
       width = 6, height = 3, dpi = 300)
```

#CONCLUSIONS:

Results: RWC showed a similar relationship with mpa.scaledas LFM, but with much less distinguishment between species (maybe because of remef??). Need to think on this more.. 

#4.0 Segmented regression: 

# Splitting by Species
```{r}
seg.ceme.subset <- rwc_pv_df %>% 
  filter(spp == "CEME")
```

```{r}
seg.adfa.subset <- rwc_pv_df %>% 
  filter(spp == "ADFA")
```

#CEME

### PC1

n.s.
```{r}
o.mod.a<-lme(PC1~rwc.int.unscaled + year.month , random=~1|id, data=seg.ceme.subset)

os.mod.a<-segmented.default(o.mod.a, ~rwc.int.unscaled, npsi=list(rwc.int.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```

###PC2
0.01812 , Est =0.591 
```{r}
o.mod.a<-lm(PC2~rwc.int.unscaled + site + year.month, random=~1|id, 
             data=seg.ceme.subset)

os.mod.a<-segmented(o.mod.a, ~rwc.int.unscaled, npsi=list(rwc.int.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```

###TTI
p = 3.692689e-07, Est = 0.985 (98.5% RWC)
```{r}
o.mod.a<-lme(tti~rwc.int.unscaled + year.month + site, random=~1|id, data=seg.ceme.subset)

os.mod.a<-segmented.default(o.mod.a, ~rwc.int.unscaled, npsi=list(rwc.int.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```

###FH
p = 5.459356e-04, Est = 0.5494623 (55%)
```{r}
o.mod.a<-lme(fh~rwc.int.unscaled + year.month + site, random=~1|id, data=seg.ceme.subset)

os.mod.a<-segmented.default(o.mod.a, ~rwc.int.unscaled, npsi=list(rwc.int.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```
###GD
n.s.
```{r}
o.mod.a<-lme(gd~rwc.int.unscaled + year.month + site, random=~1|id, data=seg.ceme.subset)

os.mod.a<-segmented.default(o.mod.a, ~rwc.int.unscaled, npsi=list(rwc.int.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```

###Temp Max. 
2.407598e-01, Est = 0.4200656  (42%)

```{r}
o.mod.a<-lme(temp.max~rwc.int.unscaled + year.month + site, random=~1|id, data=seg.ceme.subset)

os.mod.a<-segmented.default(o.mod.a, ~rwc.int.unscaled, npsi=list(rwc.int.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```

###Flame duration
n.s.
```{r}
o.mod.a<-lme(fd~rwc.int.unscaled + year.month + site, random=~1|id, data=seg.ceme.subset)

os.mod.a<-segmented.default(o.mod.a, ~rwc.int.unscaled, npsi=list(rwc.int.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```
###PFG

n.s.
```{r}
o.mod.a<-lme(pfg~rwc.int.unscaled + year.month + site, random=~1|id, data=seg.ceme.subset)

os.mod.a<-segmented.default(o.mod.a, ~rwc.int.unscaled, npsi=list(rwc.int.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```

#ADFA: 

### PC1

Not able to do version with random effects; also n.s. 
```{r}
o.mod.a<-lm(PC1~rwc.int.unscaled + site + year.month, #random=~1|id, 
             data=seg.adfa.subset)

os.mod.a<-segmented(o.mod.a, ~rwc.int.unscaled, npsi=list(rwc.int.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```
###PC2
7.68e-05, Est = 0.698 (69.8%)
```{r}
o.mod.a<-lm(PC2~rwc.int.unscaled + site + year.month, random=~1|id, 
             data=seg.adfa.subset)

os.mod.a<-segmented(o.mod.a, ~rwc.int.unscaled, npsi=list(rwc.int.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```

###TTI
n.s.
```{r}
o.mod.a<-lme(tti~rwc.int.unscaled + year.month + site, random=~1|id, data=seg.adfa.subset)

os.mod.a<-segmented.default(o.mod.a, ~rwc.int.unscaled, npsi=list(rwc.int.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```

###FH
p = 2.239756e-07, Est. = 93%
```{r}
o.mod.a<-lme(fh~rwc.int.unscaled + year.month + site, random=~1|id, data=seg.adfa.subset)

os.mod.a<-segmented.default(o.mod.a, ~rwc.int.unscaled, npsi=list(rwc.int.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```
###GD
p = 1.507566e-01, Est = 0.9752026 (97.5%)
```{r}
o.mod.a<-lme(gd~rwc.int.unscaled + year.month + site, random=~1|id, data=seg.adfa.subset)

os.mod.a<-segmented.default(o.mod.a, ~rwc.int.unscaled, npsi=list(rwc.int.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```
###Temp Max. 
p = 1.848159e-02, Est = 0.6638564  (63%)
```{r}
o.mod.a<-lme(temp.max~rwc.int.unscaled + year.month + site, random=~1|id, data=seg.adfa.subset)

os.mod.a<-segmented.default(o.mod.a, ~rwc.int.unscaled, npsi=list(rwc.int.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```

###Flame duration
n.s.
```{r}
o.mod.a<-lme(fd~rwc.int.unscaled + year.month + site, random=~1|id, data=seg.adfa.subset)

os.mod.a<-segmented.default(o.mod.a, ~rwc.int.unscaled, npsi=list(rwc.int.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```
###PFG
6.712821e-04, Est = 0.9479989 
```{r}
o.mod.a<-lme(pfg~rwc.int.unscaled + year.month + site, random=~1|id, data=seg.adfa.subset)

os.mod.a<-segmented.default(o.mod.a, ~rwc.int.unscaled, npsi=list(rwc.int.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```

#CONCLUSIONS: 

For CEME, RWC showed significant thresholds for PC2 (98%), FH (54%), and maximum temperature (42%), with no significant thresholds for PC1 or other flammability metrics and with no thresholds lining up with the TLP (75.82% +/- 15.75). 

For ADFA, there were significant thresholds for PC2 (93%), Glow Duration (97%) and Flame Height (93%), Post Flame Glow (95%), and for Maximum Temperature (66%). Of these none were close to the identified RWC at TLP (79.93% +/- 4.74). 

In terms of showing a threshold-like relationship with flammability, RWC shows more tendency to thresholding than water potential but not as much as LFM and not in a manner that would appear to align with leaf-level physiological adjustments. As RWC is a metric of physiology that does account for water status, but not dry matter content to the degree that LFM does, these results bolster our conclusion that both physiology and dry matter content are important for understanding of flammability. 

# ---------------------------------------

#Comment 2: Does LDMC correlate with TLP?

Reviewer 1: 

Stears et al. 2022 (Ecology 103 (11) Water availability dictates how plant traits predict demographic rates) found that TLP and LDMC were strongly correlated for sixteen grass and forb species (pearson correlation of 0.831).  It would be neat to check whether TLP and LDMC were also strongly correlated for the study species you encountered.  

####Data wrangling:

```{r}
local_pv_curves <- read_csv(here::here("raw-data", "allcurves.csv"), show_col_types = FALSE) %>% 
  clean_names() %>% 
  filter(#spp %in% c("CEME", "ADFA"), 
         tlp < -1.5 ) %>% 
  mutate(fresh_weight_saturated = as.numeric(fresh_weight_saturated), 
         ldmc = dry_weight/fresh_weight_saturated, 
         date = mdy(date), 
         year = year(date)) 



summary_pv_curves <- local_pv_curves %>% 
  group_by(spp, timing) %>% 
  summarise(mean_tlp = mean(tlp), 
            mean_rwc = mean(rwc_at_tlp), 
            mean_lfm = mean(lfm_at_tlp, na.rm = T))

local_pv_curves %>% 
  #filter(year != 2016)%>% 
  ggplot(aes(y = ldmc, x = tlp, color = date)) +
  geom_point() +
  facet_wrap(~spp)+
  geom_smooth(method = "lm")

local_pv_curves %>% 
  #filter(year != 2016)%>% 
  ggplot(aes(y = ldmc, x = tlp, color = date, shape = spp)) +
  geom_point() +
 # facet_wrap(~spp)+
  geom_smooth(method = "lm")
```
The code below is maybe what we actually used in the paper? Mean values are slightly different when I use the above. Starting to think I might have taken the PV parameters straight from the excel sheet (which is fine, but then need to get all that data in proper order too).

```{r, include = F, eval=FALSE}
# Section 1: Pressure Volume Curves
pv_data_all <- read_csv(here("raw-data", "allcurves_clean.csv"), show_col_types = FALSE) %>% 
  mutate(sample = as.factor(sample),
         date = lubridate::dmy(date),
         month = month(date),
         dataset = "pv") %>% 
  janitor::clean_names()

#by timing:
pv_summary_df_timing_mpa <- pv_data_all %>% 
  group_by(spp, timing) %>% 
  dplyr::summarise(ci = list(mean_cl_normal(tlp) %>% 
                        dplyr::rename(mean_tlp=y, lwr=ymin, upr=ymax))) %>% 
  unnest

pv_summary_df_timing_lfm <- pv_data_all %>% 
  drop_na(lfm_at_tlp) %>% 
  group_by(spp, timing) %>% 
  dplyr::summarise(ci = list(mean_cl_normal(lfm_at_tlp) %>% 
                        dplyr::rename(mean_lfm=y, lwr_lfm=ymin, upr_lfm=ymax))) %>% 
  unnest

pv_summary_df_timing <- merge(pv_summary_df_timing_mpa, pv_summary_df_timing_lfm, by = c("spp", "timing"), all = T)

write_csv(pv_summary_df_timing, here("processed-data", "pv_summary_df_timing1.csv"))

#by species:

pv_summary_df_spp_mpa <- pv_data_all %>% 
  group_by(spp) %>% 
  dplyr::summarise(ci = list(mean_cl_normal(tlp) %>% 
                        dplyr::rename(mean_tlp=y, lwr=ymin, upr=ymax)), 
            ci = list(mean_cl_normal(lfm_at_tlp))) %>% 
  unnest

pv_summary_df_spp_lfm <- pv_data_all %>% 
  drop_na(lfm_at_tlp) %>% 
  group_by(spp) %>% 
  dplyr::summarise(ci = list(mean_cl_normal(lfm_at_tlp) %>% 
                        dplyr::rename(mean_lfm=y, lwr_lfm=ymin, upr_lfm=ymax))) %>% 
  unnest

pv_summary_spp_timing <- merge(pv_summary_df_spp_mpa, pv_summary_df_spp_lfm, by = c("spp"), all = T)

write_csv(pv_summary_spp_timing, here("processed-data", "pv_summary_df_spp1.csv"))
```

#CONCLUSIONS: 

This is an interesting idea for further application of our dataset, but with only two species we are unable to really dig into this idea. There is large variability in both measured TLP and LDMC (across years, mostly). IF LDMC changes across seasons and TLP doesn't, then they wouldn't be strongly related. 


# ---------------------------------------

#Comment 3: LDMC and predicting flammability

Reviewer 1:

Since water potential and TLP were very predictive of flammability and thresholds, it would be great to understand whether the more easily measured and commonly available LDMC is equally as predictive and shows a similar threshold like behavior.  One potential complication, and fundamental way that LDMC measures differ from LFM is that LDMC is measured at “full hydration”, meaning leaves were fully hydrated in the lab.  We don’t know whether the authors took these types of measurements.  We see in the methods that branchlets were fully hydrated and LFM then measured periodically, so this might be a potential source for an LDMC comparison."

Reviewer 3: 

"We also think there is a potential opportunity to broaden the utility of this approach by looking at a more commonly (and easily) measured plant functional trait that has also been linked to drought response: Leaf dry matter content (LDMC). 

# MAIN LINEAR MODEL SELECTION - LDMC

#1.0 LDMC dynamics

```{r}
rwc_pv_df %>% 
  ggplot(aes(x = year.month, y = ldmc, fill = season)) +
  geom_boxplot() +
  facet_wrap(~spp)
```


#2.0 PC1

From our first round of model selection, it appears that site, species, and year.month are all important variables to include, and sample.wt should probably be included as well despite worsening the models slightly.

Below, I am going to perform another round of model selection with all possible permutations of the following metrics: mpa, lfm, dw.flam.sample, ww.flam.sample, excess_water.scaledwith the caveat that some combinations of metrics absolutely do NOT work. Those combinations are as follows:
  - dw.flam.sample, ww.flam.sample and sample.wt
  - dw.flam.sample, lfm, ww.flam.sample
  - lfm, dw.flam.sample
  - lfm, ww.flam.sample
  - lfm, excess_water.scaled
  - ww.flam.sample, excess_water.scaled
  - dw.flam.sample, excess_water.scaled (with sample.wt)
  - dw.flam.sample, ww.flam.sample (with sample.wt)
  
These do not work, as live fuel moisture was used in the calculations of these metrics, therefore they return very high VIF values that signal to us that they cannot be used in the mixed effects models together

```{r}
m1 <- lmer(PC1 ~ lfm + spp + site + year.month + sample.wt + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m1)
```


```{r}
m2 <- lmer(PC1 ~ mpa.scaled+ spp + site + year.month + sample.wt + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m2)
```

```{r}
m3 <- lmer(PC1 ~ dw.flam.sample + spp + site + year.month + sample.wt + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m3)
```

```{r}
m4 <- lmer(PC1 ~ ww.flam.sample + spp + site + year.month + sample.wt + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m4)
```

```{r}
m5 <- lmer(PC1 ~ excess_water.scaled + spp + site + year.month + sample.wt + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m5)
```

```{r}
m6 <- lmer(PC1 ~ lfm + mpa.scaled+ spp + site + year.month + sample.wt + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m6)
```

```{r}
m7 <- lmer(PC1 ~ mpa.scaled+ dw.flam.sample + spp + site + year.month + sample.wt + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m7)
```

```{r}
m8 <- lmer(PC1 ~ mpa.scaled+ ww.flam.sample + spp + site + year.month + sample.wt + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m8)
```

```{r}
m9 <- lmer(PC1 ~ mpa.scaled+ excess_water.scaled + spp + site + year.month + sample.wt + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m9)
```

```{r}
m10 <- lmer(PC1 ~ mpa.scaled+ dw.flam.sample + ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m10)
```

```{r}
m11 <- lmer(PC1 ~ dw.flam.sample + excess_water.scaled + spp + site + year.month + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m11)
```

```{r}
m12 <- lmer(PC1 ~ dw.flam.sample + ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m12)
```

```{r}
tab_model(m1, m2, m3, m4, m5, m6, m7, m8, m9, m10, m11, m12,
          show.reflvl = TRUE, 
          digits = 3, 
          show.aic = TRUE, 
          show.ci = FALSE,
          show.icc = FALSE, 
          pred.labels = c('Intercept', 'LFM (%)',
                          'Species Effect (C. megacarpus)',
                          'Site Effect (Site 1)',
                          'Sampling Date Effect (Jan 2018)',
                          'Sampling Date Effect (Dec 2019)',
                          'Sampling Date Effect (Jan 2020)',
                          'Sampling Date Effect (Sept 2020)',
                          'Sample Weight (g)',
                          'Water Potential (scaled)',
                          'Dry Weight (g)',
                          'Water Weight (g)',
                          'Excess Water (scaled)'),
         dv.labels = c("Model 1", "Model 2", "Model 3", "Model 4",
                       "Model 5", "Model 6", "Model 7", "Model 8", 
                       "Model 9","Model 10", 'Model 11', 'Model 12'),
         string.pred = "Coeffcient", 
         title = "models with no collinearity",
  string.p = "P-Value", 
  p.style = "stars",
  file = here('figures', 'MEM.figures','modelselection.html')) # saving .html into figures folder
```


Rerunning this analysis with LDMC included in the model selection:

```{r}
m2.5 <- lmer(PC1 ~ mpa.scaled + spp + site + year.month + sample.wt + ldmc + (1 | individual), data = rwc_pv_df)


m3.5 <- lmer(PC1 ~ spp + site + year.month + sample.wt + ldmc + (1 | individual), data = rwc_pv_df)

m4.5 <- lmer(PC1 ~ spp + site + year.month + ldmc + (1 | individual), data = rwc_pv_df)

m5.5 <- lmer(PC1 ~ spp + mpa.scaled + site + year.month + ldmc + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m5.5)
```

Cant include the following combination in the same model (VERY collinear): 
- dw.flam.sample and LDMC
- ww.flam.sample and LDMC
- excess.water.sclaed and LDMC
- LFM and LDMC


```{r}
tab_model(m1, m2, m3, m4, m5, m6, m7, m8, m9, m10, m11, m12, m2.5, m3.5, m4.5, m5.5,
          show.reflvl = TRUE, 
          digits = 3, 
          show.aic = TRUE, 
          show.ci = FALSE,
          show.icc = FALSE, 
         #  pred.labels = c('Intercept', 'LFM (%)',
         #                  'Species Effect (C. megacarpus)',
         #                  'Site Effect (Site 1)',
         #                  'Sampling Date Effect (Jan 2018)',
         #                  'Sampling Date Effect (Dec 2019)',
         #                  'Sampling Date Effect (Jan 2020)',
         #                  'Sampling Date Effect (Sept 2020)',
         #                  'Sample Weight (g)',
         #                  'Water Potential (scaled)',
         #                  'Dry Weight (g)',
         #                  'Water Weight (g)',
         #                  'Excess Water (scaled)'),
         dv.labels = c("Model 1", "Model 2", "Model 3", "Model 4",
                       "Model 5", "Model 6", "Model 7", "Model 8",
                       "Model 9","Model 10", 'Model 11', 'Model 12', 
                       "Model 2.5", "Model 3.5"),
         string.pred = "Coeffcient", 
         title = "models with no collinearity",
  string.p = "P-Value", 
  p.style = "stars",
  file = here('figures', 'MEM.figures','modelselection.LDMC.html')) # saving .html into figures folder
```


Looks like adding in LDMC does change things a bit, but not a lot: the 'best' model are still the following:

Top by far: 

PC1 ~ mpa.scaled+ spp + site + year.month + sample.wt + (1 | individual)

lmer(PC1 ~ spp + mpa.scaled+ site + year.month + ldmc + (1 | individual), data = rwc_pv_df)




```{r}
model_list <- c(m1, m2, m3, m4, m5, m6, m7, m8, m9, m10, m11, m12, m2.5, m3.5, m4.5, m5.5)

aictab(model_list)
```
```{r}
m5.5
```



# 2.1. Predicting raw metrics (part 2)

## Time to Ignition
Models
```{r}
m1 <- lmer(tti ~ mpa.scaled + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m2 <- lmer(tti ~ lfm + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m3 <- lmer(tti ~ ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m4 <- lmer(tti ~ dw.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m5 <- lmer(tti ~ mpa.scaled + dw.flam.sample + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)

# Adding in mpa.scaled+ WW and mpa.scaled+ LFM despite their moderate collinearity to see how they affect model selection
m6 <- lmer(tti ~ mpa.scaled + ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m7 <- lmer(tti ~ mpa.scaled + lfm + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)

#LDMC models: 
m2.5 <- lmer(tti ~ mpa.scaled+ spp + site + year.month + sample.wt + ldmc + (1 | individual), data = rwc_pv_df)

m3.5 <- lmer(tti ~ spp + site + year.month + sample.wt + ldmc + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m2.5)

m4.5 <- lmer(tti ~ spp + site + year.month + ldmc + (1 | individual), data = rwc_pv_df)

m5.5 <- lmer(tti ~ spp + mpa.scaled+ site + year.month + ldmc + (1 | individual), data = rwc_pv_df)
```

```{r}
model_list <- c(m1, m2, m3, m4, m5, m6, m7, m2.5, m3.5, m4.5, m5.5)

aictab(model_list)
```

conclusion: For TTI no models within delta 2.

## Flame Height
Models
```{r}
m1 <- lmer(fh ~ mpa.scaled + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m2 <- lmer(fh ~ lfm + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m3 <- lmer(fh ~ ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m4 <- lmer(fh ~ dw.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m5 <- lmer(fh ~ mpa.scaled + dw.flam.sample + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)

# Adding in mpa.scaled+ WW and mpa.scaled+ LFM despite their moderate collinearity to see how they affect model selection
m6 <- lmer(fh ~ mpa.scaled + ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m7 <- lmer(fh ~ mpa.scaled + lfm + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m2.5 <- lmer(fh ~ mpa.scaled+ spp + site + year.month + sample.wt + ldmc + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m2.5)



m3.5 <- lmer(fh ~ spp + site + year.month + sample.wt + ldmc + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m3.5)
m4.5 <- lmer(fh ~ spp + site + year.month + ldmc + (1 | individual), data = rwc_pv_df)

m5.5 <- lmer(fh ~ spp + mpa.scaled+ site + year.month + ldmc + (1 | individual), data = rwc_pv_df)

```


```{r}
model_list <- c(m1, m2, m3, m4, m5, m6, m7, m2.5, m3.5, m4.5, m5.5)

aictab(model_list)
```
Conclusion: For FH, no models with LDMC were in the top mod.

## Glow Duration
Models
```{r}
m1 <- lmer(gd ~ mpa.scaled + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m2 <- lmer(gd ~ lfm + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m3 <- lmer(gd ~ ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m4 <- lmer(gd ~ dw.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m5 <- lmer(gd ~ mpa.scaled + dw.flam.sample + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)

# Adding in mpa.scaled+ WW and mpa.scaled+ LFM despite their moderate collinearity to see how they affect model selection
m6 <- lmer(gd ~ mpa.scaled + ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m7 <- lmer(gd ~ mpa.scaled + lfm + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m2.5 <- lmer(gd ~ mpa.scaled+ spp + site + year.month + sample.wt + ldmc + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m2.5)



m3.5 <- lmer(gd ~ spp + site + year.month + sample.wt + ldmc + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m3.5)
m4.5 <- lmer(gd ~ spp + site + year.month + ldmc + (1 | individual), data = rwc_pv_df)

m5.5 <- lmer(gd ~ spp + mpa.scaled+ site + year.month + ldmc + (1 | individual), data = rwc_pv_df)

```


```{r}
model_list <- c(m1, m2, m3, m4, m5, m6, m7, m2.5, m3.5, m4.5, m5.5)

aictab(model_list)
```
Conclusion: For glow duration, adding in LDMC made it into the top models (close for one, not close for another)

tti ~ mpa.scaled+ spp + site + year.month + sample.wt + ldmc + (1 |  individual) (Delta AIC = 2.53)

tti ~ spp + site + year.month + sample.wt + ldmc + (1 |  individual) (Delta AIC = 1.68)


## Flame Duration


Models
```{r}
m1 <- lmer(fd ~ mpa.scaled + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m2 <- lmer(fd ~ lfm + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m3 <- lmer(fd ~ ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m4 <- lmer(fd ~ dw.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m5 <- lmer(fd ~ mpa.scaled + dw.flam.sample + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)

# Adding in mpa.scaled+ WW and mpa.scaled+ LFM despite their moderate collinearity to see how they affect model selection
m6 <- lmer(fd ~ mpa.scaled + ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m7 <- lmer(fd ~ mpa.scaled + lfm + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m2.5 <- lmer(fd ~ mpa.scaled+ spp + site + year.month + sample.wt + ldmc + (1 | individual), data = rwc_pv_df)

m3.5 <- lmer(fd ~ spp + site + year.month + sample.wt + ldmc + (1 | individual), data = rwc_pv_df)

#performance::multicollinearity(m3.5)
m4.5 <- lmer(fd ~ spp + site + year.month + ldmc + (1 | individual), data = rwc_pv_df)

m5.5 <- lmer(fd ~ spp + mpa.scaled+ site + year.month + ldmc + (1 | individual), data = rwc_pv_df)

```


```{r}
model_list <- c(m1, m2, m3, m4, m5, m6, m7, m2.5, m3.5, m4.5, m5.5)

aictab(model_list)
```
Conclusion: For flame duration, the following model was within 2 of top model: 

m4.5 <- lmer(fd ~ spp + site + year.month + ldmc + (1 | individual), data = rwc_pv_df)

## Max. Temp.

Models
```{r}
m1 <- lmer(temp.max ~ mpa.scaled + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m2 <- lmer(temp.max ~ lfm + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m3 <- lmer(temp.max ~ ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m4 <- lmer(temp.max ~ dw.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m5 <- lmer(temp.max ~ mpa.scaled + dw.flam.sample + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)

# Adding in mpa.scaled+ WW and mpa.scaled+ LFM despite their moderate collinearity to see how they affect model selection
m6 <- lmer(temp.max ~ mpa.scaled + ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m7 <- lmer(temp.max ~ mpa.scaled + lfm + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m2.5 <- lmer(temp.max ~ mpa.scaled+ spp + site + year.month + sample.wt + ldmc + (1 | individual), data = rwc_pv_df)

#performance::multicollinearity(m2.5)



m3.5 <- lmer(temp.max ~ spp + site + year.month + sample.wt + ldmc + (1 | individual), data = rwc_pv_df)

#performance::multicollinearity(m3.5)

m4.5 <- lmer(temp.max ~ spp + site + year.month + ldmc + (1 | individual), data = rwc_pv_df)

m5.5 <- lmer(temp.max ~ spp + mpa.scaled+ site + year.month + ldmc + (1 | individual), data = rwc_pv_df)

```


```{r}
model_list <- c(m1, m2, m3, m4, m5, m6, m7, m2.5, m3.5, m4.5, m5.5)

aictab(model_list)
```
Conclusion: For temp max, LDMC not under delta 2


## Post-Flame Glow
Models
```{r}
m1 <- lmer(pfg ~ mpa.scaled + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m2 <- lmer(pfg ~ lfm + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m3 <- lmer(pfg ~ ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m4 <- lmer(pfg ~ dw.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m5 <- lmer(pfg ~ mpa.scaled + dw.flam.sample + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)

# Adding in mpa.scaled+ WW and mpa.scaled+ LFM despite their moderate collinearity to see how they affect model selection
m6 <- lmer(pfg ~ mpa.scaled + ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m7 <- lmer(pfg ~ mpa.scaled + lfm + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m2.5 <- lmer(pfg ~ mpa.scaled+ spp + site + year.month + sample.wt + ldmc + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m2.5)



m3.5 <- lmer(pfg ~ spp + site + year.month + sample.wt + ldmc + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m3.5)

m4.5 <- lmer(pfg ~ spp + site + year.month + ldmc + (1 | individual), data = rwc_pv_df)

m5.5 <- lmer(pfg ~ spp + mpa.scaled+ site + year.month + ldmc + (1 | individual), data = rwc_pv_df)

```


```{r}
model_list <- c(m1, m2, m3, m4, m5, m6, m7, m2.5, m3.5, m4.5, m5.5)

aictab(model_list)
```
conclusion: 
```{r}
m5
```


## Time to First Glow
Models
```{r}
m1 <- lmer(ttfg ~ mpa.scaled + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m2 <- lmer(ttfg ~ lfm + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m3 <- lmer(ttfg ~ ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m4 <- lmer(ttfg ~ dw.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m5 <- lmer(ttfg ~ mpa.scaled + dw.flam.sample + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)

# Adding in mpa.scaled+ WW and mpa.scaled+ LFM despite their moderate collinearity to see how they affect model selection

m6 <- lmer(ttfg ~ mpa.scaled + ww.flam.sample + spp + site + year.month + (1 | individual), data = rwc_pv_df)

m7 <- lmer(ttfg ~ mpa.scaled + lfm + sample.wt + spp + site + year.month + (1 | individual), data = rwc_pv_df)
m2.5 <- lmer(ttfg ~ mpa.scaled+ spp + site + year.month + sample.wt + ldmc + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m2.5)

m3.5 <- lmer(ttfg ~ spp + site + year.month + sample.wt + ldmc + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m3.5)

m4.5 <- lmer(ttfg ~ spp + site + year.month + ldmc + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m4.5)

m5.5 <- lmer(ttfg ~ spp + mpa.scaled+ site + year.month + ldmc + (1 | individual), data = rwc_pv_df)

performance::multicollinearity(m5.5)
```


```{r}
model_list <- c(m1, m2, m3, m4, m5, m6, m7, m2.5, m3.5, m4.5, m5.5)

aictab(model_list)
```
conclusion: for TTFG, none made it in. 

```{r}
m3.5
```

#CONCLUSIONS: 

Models with LDMC were generally top-performing, but only when combined with water potential: for no flammability metric was LDMC alone the best predictor. LDMC functions in a similar manner to other covariates that incorporate aspects of dry matter content. Compared to these other metrics, LDMC performed equally well or very slightly better than LFM, sample dry weight, or sample fresh weight. AS LDMC requires full rehydration to calculate, the slight improvements in model selection will typically not outweigh the additional work of rehydrating leaves for LDMC determination. 

#3.0 SEGMENTED REGRESSION: 

#CEME

### PC1

n.s.
```{r}
o.mod.a<-lme(PC1~ldmc.unscaled + mpa.unscaled +year.month , random=~1|id, data=seg.ceme.subset)

os.mod.a<-segmented.default(o.mod.a, ~ldmc.unscaled, npsi=list(ldmc.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```

###PC2
n.s.
```{r}
o.mod.a<-lme(PC2~ldmc.unscaled + mpa.unscaled +site + year.month, random=~1|id, 
             data=seg.ceme.subset)

os.mod.a<-segmented(o.mod.a, ~mpa.unscaled, npsi=list(mpa.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```

###TTI
n.s.
```{r}
o.mod.a<-lme(tti~ldmc.unscaled + mpa.unscaled +year.month + site, random=~1|id, data=seg.ceme.subset)

os.mod.a<-segmented.default(o.mod.a, ~ mpa.unscaled, npsi=list(mpa.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```

###FH
n.s.
```{r}
o.mod.a<-lme(fh~ldmc.unscaled + mpa.unscaled +year.month + site, random=~1|id, data=seg.ceme.subset)

os.mod.a<-segmented.default(o.mod.a, ~mpa.unscaled, npsi=list(mpa.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```
###GD
n.s.
```{r}
o.mod.a<-lme(gd~ldmc.unscaled + mpa.unscaled +year.month + site, random=~1|id, data=seg.ceme.subset)

os.mod.a<-segmented.default(o.mod.a, ~mpa.unscaled, npsi=list(mpa.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```

###Temp Max. 
2.407598e-01, Est = 0.4200656  (42%)

```{r}
o.mod.a<-lme(temp.max~ldmc.unscaled + mpa.unscaled +year.month + site, random=~1|id, data=seg.ceme.subset)

os.mod.a<-segmented.default(o.mod.a, ~mpa.unscaled, npsi=list(mpa.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```

###Flame duration
n.s.
```{r}
o.mod.a<-lme(fd~ldmc.unscaled + mpa.unscaled +year.month + site, random=~1|id, data=seg.ceme.subset)

os.mod.a<-segmented.default(o.mod.a, ~mpa.unscaled, npsi=list(mpa.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```
###PFG

n.s.
```{r}
o.mod.a<-lme(pfg~ldmc.unscaled + mpa.unscaled +year.month + site, random=~1|id, data=seg.ceme.subset)

os.mod.a<-segmented.default(o.mod.a, ~mpa.unscaled, npsi=list(mpa.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```

#ADFA: 

### PC1

Not able to do version with random effects; also n.s. 
```{r}
o.mod.a<-lm(PC1~ldmc.unscaled + mpa.unscaled +site + year.month, #random=~1|id, 
             data=seg.adfa.subset)

os.mod.a<-segmented(o.mod.a, ~ldmc.unscaled, npsi=list(ldmc.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```
###PC2
7.68e-05, Est = 0.698 (69.8%)
```{r}
o.mod.a<-lm(PC2~ldmc.unscaled + mpa.unscaled +site + year.month, random=~1|id, 
             data=seg.adfa.subset)

os.mod.a<-segmented(o.mod.a, ~ldmc.unscaled, npsi=list(ldmc.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```

###TTI
n.s.
```{r}
o.mod.a<-lme(tti~ldmc.unscaled + mpa.unscaled +year.month + site, random=~1|id, data=seg.adfa.subset)

os.mod.a<-segmented.default(o.mod.a, ~ldmc.unscaled, npsi=list(ldmc.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```

###FH
p = 2.239756e-07, Est. = 93%
```{r}
o.mod.a<-lme(fh~ldmc.unscaled + mpa.unscaled +year.month + site, random=~1|id, data=seg.adfa.subset)

os.mod.a<-segmented.default(o.mod.a, ~ldmc.unscaled, npsi=list(ldmc.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```
###GD
p = 1.507566e-01, Est = 0.9752026 (97.5%)
```{r}
o.mod.a<-lme(gd~ldmc.unscaled + mpa.unscaled +year.month + site, random=~1|id, data=seg.adfa.subset)

os.mod.a<-segmented.default(o.mod.a, ~ldmc.unscaled, npsi=list(ldmc.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```
###Temp Max. 
p = 1.848159e-02, Est = 0.6638564  (63%)
```{r}
o.mod.a<-lme(temp.max~ldmc.unscaled + mpa.unscaled +year.month + site, random=~1|id, data=seg.adfa.subset)

os.mod.a<-segmented.default(o.mod.a, ~ldmc.unscaled, npsi=list(ldmc.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```

###Flame duration
n.s.
```{r}
o.mod.a<-lme(fd~ldmc.unscaled + mpa.unscaled +year.month + site, random=~1|id, data=seg.adfa.subset)

os.mod.a<-segmented.default(o.mod.a, ~ldmc.unscaled, npsi=list(ldmc.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```
###PFG
6.712821e-04, Est = 0.9479989 
```{r}
o.mod.a<-lme(pfg~ldmc.unscaled + mpa.unscaled +year.month + site, random=~1|id, data=seg.adfa.subset)

os.mod.a<-segmented.default(o.mod.a, ~ldmc.unscaled, npsi=list(ldmc.unscaled=1))
#summarizing results (note the '.coef' argument)
#m <- slope(os.mod.a, .coef = fixef(os.mod.a))[[1]][[1]]
summary.segmented(os.mod.a)
```

#CONCLUSIONS: 

Not enough data (LDMC only present for each individual), and inclusion of LDMC as a covariate with water potential also did not increase the likelihood of a significant breakpoint. 

